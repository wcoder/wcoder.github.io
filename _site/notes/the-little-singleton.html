<!DOCTYPE html> <html prefix="og: http://ogp.me/ns#" lang="ru"> <head> <meta charset="utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> <title>Маленький Singleton - YP Tech Notes</title> <meta name="description" content="Ты узнаешь это:" /> <meta name="keywords" content="паттерны, тестирование, перевод" /> <meta name="author" content="Yauheni Pakala"> <meta property="og:title" content="Маленький Singleton - YP Tech Notes" /> <meta property="og:description" content="Ты узнаешь это:" /> <meta property="og:url" content="https://wcoder.github.io/notes/the-little-singleton" /> <meta property="og:site_name" content="YP Tech Notes" /> <meta property="og:locale" content="ru_RU" /> <meta property="og:type" content="article" /> <meta property="article:author" content="Yauheni Pakala" /> <meta property="article:published_time" content="2016-03-01T00:00:00+03:00" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:creator" content="@yauhenipakala" /> <meta name='yandex-verification' content='7cd440e16ce6e1c3' /> <link rel="icon" type="image/x-icon" href="/images/favicon.ico" /> <link rel="stylesheet" href="/css/main.css" /> <link rel="stylesheet" href="/css/github.min.css" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="YP Tech Notes" /> <meta name="apple-mobile-web-app-title" content="YP Tech Notes" /> <meta name="theme-color" content="#333" /> <meta name="msapplication-navbutton-color" content="#333" /> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /> <meta name="msapplication-starturl" content="/" /> <link rel="manifest" href="/api/manifest.json" /> <link rel="canonical" href="https://wcoder.github.io/notes/the-little-singleton" /> <link rel="alternate" type="application/atom+xml" title="YP Tech Notes" href="https://wcoder.github.io/atom.xml" /> </head> <body> <header class="site-header"><div class="wrapper"> <a class="site-title" href="/" title="Перейти на главную">Tech Notes</a> <nav class="site-nav"> <a href="#" class="menu-icon" title="Развернуть меню"> <svg xmlns="http://www.w3.org/2000/svg" height="29" viewbox="0 0 48 48" width="48"><path d="M0 0h48v48h-48z" fill="none"></path><path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"></path> </svg> </a><div class="trigger"> <a class="page-link" href="https://ypakala.com/">Об авторе</a> <a class="page-link" href="/archive/">Архив</a> <a class="page-link" href="/search/">Поиск</a> <a class="page-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a>
</div></nav>
</div></header><div class="page-content"><div class="wrapper"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"><h1 class="post-title" itemprop="name headline">Маленький Singleton</h1>
<p class="post-meta"> <time datetime="2016-03-01T00:00:00+03:00" itemprop="datePublished">01.03.2016 в 00:00</time></p></header><div class="post-content" itemprop="articleBody">
<p>Ты узнаешь это:</p>
<pre><code class="language-java">public class X {
	private static X instance = null;

	private X() {}

	public static X instance() {
		if (instance == null)
			instance = new X();
		return instance;
	}

	// more methods...
}
</code></pre>
<blockquote><p>Конечно. Это паттерн Singleton (Одиночка) из книги банды четырех. Я всегда слышал, что мы не должны использовать его.</p></blockquote>
<p>Почему мы не должны использовать его?</p>
<blockquote><p>Потому, что это делает наши системы трудно тестируемыми.</p></blockquote>
<p>Это делает? Почему?</p>
<blockquote><p>Потому, что мы не можем <a href="https://ru.wikipedia.org/wiki/Mock-%D0%BE%D0%B1%D1%8A%D0%B5%D0%BA%D1%82">замокать</a> наш синглтон.</p></blockquote>
<p>Вы не можете? Почему?</p>
<blockquote><p>Ну, потому что, единственный класс, который может касаться приватной переменной, это сам singleton.</p></blockquote>
<p>Ты знаешь правило о инкапсуляции и тестах?</p>
<blockquote><p>Мм, нет. Какое правило?</p></blockquote>
<p>Тесты выше инкапсуляции.</p>
<blockquote><p>Что это значит?</p></blockquote>
<p>Это означает, что тесты побеждают. Никакому тесту не может быть запрещен доступ к переменной просто для того, чтобы поддержать инкапсуляцию.</p>
<blockquote><p>Вы имеете ввиду - если тесту нужен доступ к приватной переменной…</p></blockquote>
<p>…переменная не должна быть приватной. Да.</p>
<blockquote><p>Просто это звучит неправильно. Я имею в виду, инкапсуляция важна!</p></blockquote>
<p>Тесты более важны.</p>
<blockquote><p>Погодите. Что?</p></blockquote>
<p>Что хорошего в инкапсулированном коде, если вы не можете его протестировать?</p>
<blockquote><p>Хорошо, хорошо, но какое это имеет отношение к тестированию синглтонов.</p></blockquote>
<p>Посмотрите на этот код.</p>
<pre><code class="language-java">public class X {
	static X instance = null;

	private X() {}

	public static X instance() {
		if (instance == null)
			instance = new X();
		return instance;
	}

	// methods.
}

class TestX {
	@Before
	public setup() {
		X.instance = new XMock();
	}
}

class XMock extends X {
	// overide methods
}
</code></pre>
<blockquote><p>О, вы сделали переменную <code>instance</code> доступной в контексте “пакета”.</p></blockquote>
<p>Верно</p>
<blockquote><p>И это позволяет Вам замокать синглтон.</p></blockquote>
<p>Верно.</p>
<blockquote><p>И это означает, что синглтон можно просто мокать.</p></blockquote>
<p>Верно. Теперь посмотрим на это:</p>
<pre><code class="language-java">public class X {
	public static X instance = new X();

	private X() {}

	// methods.
}
</code></pre>
<blockquote><p>Подождите! А куда делся метод <code>instance</code>?</p></blockquote>
<p>Мне он не нужен.</p>
<blockquote><p>Ааа, переменная <code>instance</code> публичная. Вы можете просто использовать ее.</p></blockquote>
<p>Верно.</p>
<blockquote><p>Но… Но… Кто-то может перезаписать ее?</p></blockquote>
<p>Кто это может сделать?</p>
<blockquote><p>Я не знаю. Эмм. Кто-то плохой.</p></blockquote>
<p>В вашей команде есть плохие люди?</p>
<blockquote><p>Нет. Но. Так не чувствуешь себя в безопастности.</p></blockquote>
<p>Ну, если бы это было частью общедоступного API, то я согласился бы с Вами. Но если это - просто код, который используется нашей командой тогда…</p>
<blockquote><p>Мы доверяем нашей команде?</p></blockquote>
<p>Конечно.</p>
<blockquote><p>И это довольно просто замокать, не так ли?</p></blockquote>
<p>Конечно.</p>
<blockquote><p>Таким образом я предполагаю, что мы могли использовать синглтон, если бы хотели.</p></blockquote>
<p>Конечно. Хотя большую часть времени я не хочу.</p>
<blockquote><p>В конце концов, это… и теперь Вы говорите, что не хотите использовать синглтон в любом случае?</p></blockquote>
<p>Ну… я думаю, что важно понять для чего.</p>
<blockquote><p>Хорошо, так почему бы тебе не использовать синглтон?</p></blockquote>
<p>Иногда я использую. Особенно в публичных API.</p>
<blockquote><p>Вы имеете в виду что это снова вопрос доверия?</p></blockquote>
<p>Верно. В публичном API, если я хочу гарантировать создание только одного экземпляра, тогда я буду использовать синглтон.</p>
<blockquote><p>Хорошо, но тогда что, если это не публичное API, но Вы все еще просто хотите создать один экземпляр?</p></blockquote>
<p>Ну, тогда я просто создаю один.</p>
<hr>
<p>Robert Martin (Uncle Bob)</p>
<p><a href="https://blog.8thlight.com/uncle-bob/2015/06/30/the-little-singleton.html" name="original">Оригинал</a></p>
<p>Теги: <a href="/tags/#%D0%BF%D0%B0%D1%82%D1%82%D0%B5%D1%80%D0%BD%D1%8B">паттерны</a>, <a href="/tags/#%D1%82%D0%B5%D1%81%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">тестирование</a>, <a href="/tags/#%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4">перевод</a></p>
<p class="edit-post-btn"> <!--noindex--><a href="https://github.com/wcoder/wcoder.github.io/edit/master/_posts/2016-03-01-the-little-singleton.md" rel="nofollow" title="Редактировать страницу на GitHub">Редактировать</a><!--/noindex--></p>
<div class="share-btn"> <a class="btn-vk" data-id="vk" title="VK"><img alt="VK" width="16" src="/images/vk.svg"></a> <a class="btn-facebook" data-id="fb" title="Facebook"><img alt="Facebook" width="16" src="/images/facebook.svg"></a> <a class="btn-twitter" data-id="tw" title="Twitter"><img alt="Twitter" width="16" src="/images/twitter.svg"></a> <a class="btn-telegram" data-id="tg" title="Telegram"><img alt="Telegram" width="16" src="/images/telegram.svg"></a> <a class="btn-mail" data-id="mail" title="Email"><img alt="Email" width="16" src="/images/mail.svg"></a>
</div>
</div></article>
</div></div><hr><div class="wrapper"> <footer class="footer"><p class="copyrights"> © 2014–<span itemprop="copyrightYear">2025</span></p>
<p xmlns:cc="http://creativecommons.org/ns#" class="license"> <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" title="This work is licensed under CC BY-SA 4.0"> <img style="height:20px!important;" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png" alt="CC BY-SA 4.0"> </a></p></footer>
</div><script src="/js/highlight.pack.js"></script> <script src="/js/highlightjs-line-numbers.min.js"></script> <script> hljs.initHighlightingOnLoad(); hljs.initLineNumbersOnLoad(); </script> <script src="/js/share-buttons.js"></script> <!--Generated with Jekyll at Nov. 11, 2025 11:59:43 AM (+03)--> </body> </html>
