<!DOCTYPE html> <html prefix="og: http://ogp.me/ns#" lang="ru"> <head> <meta charset="utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> <title>DRY о знании - YP Tech Notes</title> <meta name="description" content="Дублирование кода не проблема." /> <meta name="keywords" content="перевод, ddd, dry" /> <meta name="author" content="Yauheni Pakala"> <meta property="og:title" content="DRY о знании - YP Tech Notes" /> <meta property="og:description" content="Дублирование кода не проблема." /> <meta property="og:url" content="https://wcoder.github.io/notes/dry-is-about-knowledge" /> <meta property="og:site_name" content="YP Tech Notes" /> <meta property="og:locale" content="ru_RU" /> <meta property="og:type" content="article" /> <meta property="article:author" content="Yauheni Pakala" /> <meta property="article:published_time" content="2015-11-07T19:41:00+03:00" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:creator" content="@yauhenipakala" /> <meta name='yandex-verification' content='7cd440e16ce6e1c3' /> <link rel="icon" type="image/x-icon" href="/images/favicon.ico" /> <link rel="stylesheet" href="/css/main.css" /> <link rel="stylesheet" href="/css/github.min.css" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="YP Tech Notes" /> <meta name="apple-mobile-web-app-title" content="YP Tech Notes" /> <meta name="theme-color" content="#333" /> <meta name="msapplication-navbutton-color" content="#333" /> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /> <meta name="msapplication-starturl" content="/" /> <link rel="manifest" href="/api/manifest.json" /> <link rel="canonical" href="https://wcoder.github.io/notes/dry-is-about-knowledge" /> <link rel="alternate" type="application/atom+xml" title="YP Tech Notes" href="https://wcoder.github.io/atom.xml" /> </head> <body> <header class="site-header"><div class="wrapper"> <a class="site-title" href="/" title="Перейти на главную">Tech Notes</a> <nav class="site-nav"> <a href="#" class="menu-icon" title="Развернуть меню"> <svg xmlns="http://www.w3.org/2000/svg" height="29" viewbox="0 0 48 48" width="48"><path d="M0 0h48v48h-48z" fill="none"></path><path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"></path> </svg> </a><div class="trigger"> <a class="page-link" href="https://ypakala.com/">Об авторе</a> <a class="page-link" href="/archive/">Архив</a> <a class="page-link" href="/search/">Поиск</a> <a class="page-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a>
</div></nav>
</div></header><div class="page-content"><div class="wrapper"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"><h1 class="post-title" itemprop="name headline">DRY о знании</h1>
<p class="post-meta"> <time datetime="2015-11-07T19:41:00+03:00" itemprop="datePublished">07.11.2015 в 19:41</time></p></header><div class="post-content" itemprop="articleBody">
<p>Дублирование кода не проблема.</p>
<p>Взгляните на эти два класса:</p>
<pre><code class="language-php">&lt;?php // пример 1
final class Basket
{
	private $products;

	public function addProduct($product)
	{
		if (3 == count($this-&gt;products)) {
			throw new Exception("Максимально разрешено 3 продукта");
		}
		$this-&gt;products[] = $product;
	}
}

final class Shipment
{
	private $products;

	public function addProduct($product)
	{
		if (3 == count($this-&gt;products)) {
			throw new Exception("Максимально разрешено 3 продукта");
		}
		$this-&gt;products[] = $product;
	}
}
</code></pre>
<p>Вы сказали бы, что это дублирование кода? Это нарушает DRY принцип (<a href="https://ru.wikipedia.org/wiki/Don%E2%80%99t_repeat_yourself">Don’t Repeat Yourself</a>)?</p>
<p>Если да, то решение избавится от него, могло бы быть что-то вроде этого:</p>
<pre><code class="language-php">&lt;?php // пример 2
abstract class ProductContainer
{
	protected $products;

	public function addProduct($product)
	{
		if (3 == count($this-&gt;products)) {
			throw new Exception("Максимально разрешено 3 продукта");
		}
		$this-&gt;products[] = $product;
	}
}

final class Basket extends ProductContainer {}
final class Shipment extends ProductContainer {}
</code></pre>
<p>Код идентичен, но почему? Как хорошие DDD (<a href="https://ru.wikipedia.org/wiki/%D0%9F%D1%80%D0%BE%D0%B1%D0%BB%D0%B5%D0%BC%D0%BD%D0%BE-%D0%BE%D1%80%D0%B8%D0%B5%D0%BD%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D0%BE%D0%B5_%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5">Domain-driven design</a>) практики, мы должны были бы свериться с бизнесом. Продуктом мог быть легковоспламеняющийся химикат, и для безопасности, отгрузка не разрешается если имеем более трех из них. Как следствие, мы не позволяем клиентам заказывать более трех одновременно.</p>
<p>В другом сценарии сходство кода также может быть простым совпадением. Может быть поставка продукции ограничена и мы хотим, дать нашим клиентам равные возможности для ее покупки.</p>
<p><img src="http://verraes.net/img/posts/2014-08-02-dry-is-about-knowledge/find-the-differences-small.jpg" alt="найдите отличия"></p>
<h2 id="причины-для-изменения">Причины для изменения</h2>
<p>В любом случае, это не имеет значения. Проблема в том, что правила могут измениться самостоятельно. Предприятие может понять, что они все еще могут продать больше, чем три продукта за один раз и разделить продукты на несколько поставок. В примере 2, мы застреваем с высокой связонностью обоих типов доменных объектов к тому же бизнес-правилу, и косвенно друг с другом. Изменение правил для <code>Basket</code> изменяет правило для <code>Shipment</code>, но потенциально имеет опасные последствия в реальном мире. Пример, конечно, откровенно простой, чтобы осуществить рефакторинг, но устаревший код обычно намного сложнее.</p>
<p>Вы могли бы попытаться решить проблему путем абстрагирования предела:</p>
<pre><code class="language-php">&lt;?php // пример 3
abstract class ProductContainer
{
	protected $products;

	public function addProduct($product)
	{
		if ($this-&gt;getProductLimit() == count($this-&gt;products)) {
			throw new Exception(sprintf("Максимально разрешено %d продукта", $this-&gt;getProductLimit()));
		}
		$this-&gt;products[] = $product;
	}

	abstract protected function getProductLimit();
}
</code></pre>
<p>Это работает в определенной степени, но правила могут измениться самым неожиданным образом. Пример 3 предполагает, что предел всегда легко определить с помощью одного вызова метода. Новые правила могли бы принять во внимание клиента, их историю с нашей компанией, определенными юридическими условиями, продвижениями, и т.д. Новые правила могут динамично влиять на число продуктов, которые Вы можете купить способами, которые не могут быть смоделированы, используя наш абстрактный метод <code>addProduct()</code>.</p>
<h2 id="знание">Знание</h2>
<p>Бизнес-правило в моем примере не “Максимально разрешено 3 продукта”. Есть фактически два бизнес-правила: “Корзине не позволяют иметь больше чем три продукта”, и “Отгрузке не позволяют иметь больше чем три продукта”. Два правила, независимо от того, насколько похожи, должны иметь два отдельных представления в модели.</p>
<p>“Don’t Repeat Yourself” никогда не был о коде. Это о знании. Это о сцеплении. Если две части кода будут представлять то же самое знание, то они будут всегда изменяться вместе. Необходимость изменения их обоих опасна: вы могли бы забыть одного из них. С другой стороны, если два одинаковых фрагмента кода представляют разные знания, они будут меняться независимо. Недублирование их представляет риск, потому что, изменяя знание для одного объекта, мог бы случайно изменить его для другого объекта.</p>
<p>При рассмотрении причин изменения, очень мощным является эвристическое моделирование.</p>
<h2 id="далее">Далее</h2>
<p>Последующие посты:</p>
<ul> <li>
<a href="http://blog.ploeh.dk/2014/08/07/why-dry/">Why DRY?</a> by Mark Seemann (<a href="https://twitter.com/ploeh">@ploeh</a>)</li> <li>
<a href="http://www.devjoy.com/2014/09/aim-for-dry-but-be-willing-to-fall-short/">Aim for DRY, but be willing to fall short</a> by Richard Dalton (<a href="https://twitter.com/richardadalton">@richardadalton</a>)</li>
</ul>
<p>Некоторые посты о DDD:</p>
<ul> <li><a href="http://verraes.net/2014/01/domain-driven-design-is-linguistic/">Domain-Driven Design is linguistic</a></li> <li><a href="http://verraes.net/2014/05/why-domain-driven-design-matters/">Why Domain-Driven Design Matters</a></li>
</ul>
<p><a href="http://verraes.net/2014/08/dry-is-about-knowledge/" name="original">Оригинал</a></p>
<p>Теги: <a href="/tags/#%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4">перевод</a>, <a href="/tags/#ddd">ddd</a>, <a href="/tags/#dry">dry</a></p>
<p class="edit-post-btn"> <!--noindex--><a href="https://github.com/wcoder/wcoder.github.io/edit/master/_posts/2015-11-07-dry-is-about-knowledge.md" rel="nofollow" title="Редактировать страницу на GitHub">Редактировать</a><!--/noindex--></p>
<div class="share-btn"> <a class="btn-vk" data-id="vk" title="VK"><img alt="VK" width="16" src="/images/vk.svg"></a> <a class="btn-facebook" data-id="fb" title="Facebook"><img alt="Facebook" width="16" src="/images/facebook.svg"></a> <a class="btn-twitter" data-id="tw" title="Twitter"><img alt="Twitter" width="16" src="/images/twitter.svg"></a> <a class="btn-telegram" data-id="tg" title="Telegram"><img alt="Telegram" width="16" src="/images/telegram.svg"></a> <a class="btn-mail" data-id="mail" title="Email"><img alt="Email" width="16" src="/images/mail.svg"></a>
</div>
</div></article>
</div></div><hr><div class="wrapper"> <footer class="footer"><p class="copyrights"> © 2014–<span itemprop="copyrightYear">2025</span></p>
<p xmlns:cc="http://creativecommons.org/ns#" class="license"> <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" title="This work is licensed under CC BY-SA 4.0"> <img style="height:20px!important;" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png" alt="CC BY-SA 4.0"> </a></p></footer>
</div><script src="/js/highlight.pack.js"></script> <script src="/js/highlightjs-line-numbers.min.js"></script> <script> hljs.initHighlightingOnLoad(); hljs.initLineNumbersOnLoad(); </script> <script src="/js/share-buttons.js"></script> <!--Generated with Jekyll at Nov. 11, 2025 11:59:43 AM (+03)--> </body> </html>
