<!DOCTYPE html> <html prefix="og: http://ogp.me/ns#" lang="ru"> <head> <meta charset="utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> <title>Использование SkiaSharp для конвертации SVG в Xamarin.Forms ImageSource - YP Tech Notes</title> <meta name="description" content="При работе с изображениями в проекте вашего приложения должно быть творится ад, пока вам нужно много различных разрешений для каждого изображения. Но, что ес..." /> <meta name="keywords" content="xamarin, xamarin forms, skiasharp, svg, перевод" /> <meta name="author" content="Yauheni Pakala"> <meta property="og:title" content="Использование SkiaSharp для конвертации SVG в Xamarin.Forms ImageSource - YP Tech Notes" /> <meta property="og:description" content="При работе с изображениями в проекте вашего приложения должно быть творится ад, пока вам нужно много различных разрешений для каждого изображения. Но, что ес..." /> <meta property="og:url" content="https://wcoder.github.io/notes/use-skiasharp-to-convert-svg-to-xamarin-forms-imagesource" /> <meta property="og:site_name" content="YP Tech Notes" /> <meta property="og:locale" content="ru_RU" /> <meta property="og:type" content="article" /> <meta property="article:author" content="Yauheni Pakala" /> <meta property="article:published_time" content="2018-03-17T17:10:00+03:00" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:creator" content="@yauhenipakala" /> <meta name='yandex-verification' content='7cd440e16ce6e1c3' /> <link rel="icon" type="image/x-icon" href="/images/favicon.ico" /> <link rel="stylesheet" href="/css/main.css" /> <link rel="stylesheet" href="/css/github.min.css" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="YP Tech Notes" /> <meta name="apple-mobile-web-app-title" content="YP Tech Notes" /> <meta name="theme-color" content="#333" /> <meta name="msapplication-navbutton-color" content="#333" /> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /> <meta name="msapplication-starturl" content="/" /> <link rel="manifest" href="/api/manifest.json" /> <link rel="canonical" href="https://wcoder.github.io/notes/use-skiasharp-to-convert-svg-to-xamarin-forms-imagesource" /> <link rel="alternate" type="application/atom+xml" title="YP Tech Notes" href="https://wcoder.github.io/atom.xml" /> </head> <body> <header class="site-header"><div class="wrapper"> <a class="site-title" href="/" title="Перейти на главную">Tech Notes</a> <nav class="site-nav"> <a href="#" class="menu-icon" title="Развернуть меню"> <svg xmlns="http://www.w3.org/2000/svg" height="29" viewBox="0 0 48 48" width="48"><path d="M0 0h48v48h-48z" fill="none"></path><path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"></path> </svg> </a><div class="trigger"> <a class="page-link" href="https://ypakala.com/">Об авторе</a> <a class="page-link" href="/archive/">Архив</a> <a class="page-link" href="/search/">Поиск</a> <a class="page-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a></div></nav></div></header><div class="page-content"><div class="wrapper"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"><h1 class="post-title" itemprop="name headline">Использование SkiaSharp для конвертации SVG в Xamarin.Forms ImageSource</h1><p class="post-meta"> <time datetime="2018-03-17T17:10:00+03:00" itemprop="datePublished">17.03.2018 в 17:10</time></p></header><div class="post-content" itemprop="articleBody"><p>При работе с изображениями в проекте вашего приложения должно быть творится ад, пока вам нужно много различных разрешений для каждого изображения. Но, что если мы могли бы использовать векторную графику для изображений? К сожалению, Xamarin.Forms не поддерживает этого из коробки. Но это возможно с помощью <a href="https://github.com/mono/SkiaSharp">SkiaSharp</a>. SkiaSharp - кросс-платформенный API для 2D-графики, для платформы .NET, основанное на <a href="https://skia.org/">Skia Graphics Library</a> от Google.</p><p>Есть пакет для Xamarin.Forms, который мы можем добавить в ваш проект, если хотим добавить Skia холст к нашим представлениям. Это здорово, но есть небольшое ограничение. Для примера, мы не можем использовать его для иконок в TabbedPage. Эта заметка покажет, как создать вспомогательный класс, который с помощью SkiaSharp преобразует SVG в ImageSource.</p><p>Прежде всего, нам нужно установить два NuGet-пакета:</p><ul> <li>SkiaSharp.View.Forms</li> <li>SkiaSharp.Svg</li></ul><p>Наш вспомогательный класс будет принимать четыре аргумента: имя файла, ширину, высоту, цвет:</p><pre><code class="language-csharp">public class SvgHelper
{
    public static ImageSource GetAsImageSource(string svgImage, float width, float height, Color color)
    {
    }
}
</code></pre><p>Чтобы сделать это правильно, нам нужно знать коэффициент масштаба для устройства, на котором работает приложение:</p><pre><code class="language-csharp">var scaleFactor = 0;

#if __IOS__
    scaleFactor = (int)UIKit.UIScreen.MainScreen.Scale;
#elif __ANDROID__
     // В MainActivity добавлено статическое свойство Current.
     scaleFactor = MainActivity.Current.Resources.DisplayMetrics.Density
#endif
</code></pre><p>Следующий шаг, загрузка SVG изображения:</p><pre><code class="language-csharp">var svg = new SkiaSharp.Extended.Svg.SKSvg();

#if __IOS__
    svg.Load(svgImage);
#elif __ANDROID__
    var assetStream = MainActivity.Current.Assets.Open(svgImage);
    svg.Load(assetStream);
#endif
</code></pre><p>Когда мы загрузили SVG, нам нужно с масштабировать его до размера, который вы передали методу:</p><pre><code class="language-csharp">var svgSize = svg.Picture.CullRect;
var svgMax = Math.Max(svgSize.Width, svgSize.Height);

float canvasMin = Math.Min((int)(width * scaleFactor), (int)(height * scaleFactor));
var scale = canvasMin / svgMax;
var matrix = SKMatrix.MakeScale(scale, scale);
</code></pre><p>Теперь, пришло время для отрисовки изображения, для этого нам нужен холст. Его размер будет определен в растровом изображении, которое мы передадим конструктору <code>SKCanvas</code>. Мы также хотим использовать цвет, что бы не иметь несколько изображений для разных цветов.</p><pre><code class="language-csharp">var bitmap = new SKBitmap((int)(width*scaleFactor), (int)(height*scaleFactor));

var paint = new SKPaint()
{
    ColorFilter = SKColorFilter.CreateBlendMode(color.ToSKColor(), SKBlendMode.SrcIn)
};

var canvas = new SKCanvas(bitmap);
canvas.DrawPicture(svg.Picture, ref matrix, paint);
</code></pre><p>Теперь у нас есть холст, следующим шагом будет конвертация холста в поток, чтобы мы могли создать из него Xamarin.Forms <code>ImageSource</code>.</p><pre><code class="language-csharp">var image = SKImage.FromBitmap(bitmap);
var encoded = image.Encode();
var stream = encoded.AsStream();
var source = ImageSource.FromStream(() =&gt; stream);

return source;
</code></pre><p>Теперь мы можем использовать его, чтобы установить источник изображения.</p><pre><code class="language-csharp">var image = new Image();
image.Source = SvgHelper. GetAsImageSource("my_icon.svg", 30, 30, Color.Black);
</code></pre><p>Если вы хотите использовать это в XAML, одним из решений будет дополнительно создать MarkupExtension:</p><pre><code class="language-csharp">public class DrawImageExtension : IMarkupExtension
{
    public object ProvideValue(IServiceProvider serviceProvider)
    {
        var source = SvgHelper.GetAsImageSource(FileName, Width, Height, Color);

        return source;
    }

    public string FileName { get; set; }
    public float Width { get; set; }
    public float Height { get; set; }
    public Color Color { get; set; }
}
</code></pre><p>Нам просто нужно импортировать пространство имен для расширения, а затем уже использовать его так:</p><pre><code class="language-xml">&lt;ContentPage
     xmlns="http://xamarin.com/schemas/2014/forms"
     xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
     xmlns:ext="clr-namespace:MyApp.Extensions" x:Class="MyApp.MyPage"&gt;
     &lt;StackLayout&gt;
          &lt;Image Source="{ext:DrawImage FileName=my_icon.svg, Width=25, Height=25, Color=White}" /&gt;
     &lt;/StackLayout&gt;
&lt;/ContentPage&gt;
</code></pre><p>На этом все!</p><p><a href="http://danielhindrikes.se/xamarin/use-skiasharp-to-convert-svg-to-xamarin-forms-imagesource/" name="original">Оригинал</a></p><p>Теги: <a href="/tags/#xamarin">xamarin</a>, <a href="/tags/#xamarin+forms">xamarin forms</a>, <a href="/tags/#skiasharp">skiasharp</a>, <a href="/tags/#svg">svg</a>, <a href="/tags/#%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4">перевод</a></p><p class="edit-post-btn"> <!--noindex--><a href="https://github.com/wcoder/wcoder.github.io/edit/master/_posts/2018-03-17-use-skiasharp-to-convert-svg-to-xamarin-forms-imagesource.md" rel="nofollow" title="Редактировать страницу на GitHub">Редактировать</a><!--/noindex--></p><div class="share-btn"> <a class="btn-vk" data-id="vk" title="VK"><img alt="VK" width="16" src="/images/vk.svg" /></a> <a class="btn-facebook" data-id="fb" title="Facebook"><img alt="Facebook" width="16" src="/images/facebook.svg" /></a> <a class="btn-twitter" data-id="tw" title="Twitter"><img alt="Twitter" width="16" src="/images/twitter.svg" /></a> <a class="btn-telegram" data-id="tg" title="Telegram"><img alt="Telegram" width="16" src="/images/telegram.svg" /></a> <a class="btn-mail" data-id="mail" title="Email"><img alt="Email" width="16" src="/images/mail.svg" /></a></div></div></article></div></div><hr /><div class="wrapper"> <footer class="footer"><p class="copyrights"> &copy; 2014&ndash;<span itemprop="copyrightYear">2025</span></p><p xmlns:cc="http://creativecommons.org/ns#" class="license"> <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" title="This work is licensed under CC BY-SA 4.0"> <img style="height:20px!important;" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png" alt="CC BY-SA 4.0"> </a></p></footer></div><script src="/js/highlight.pack.js"></script> <script src="/js/highlightjs-line-numbers.min.js"></script> <script> hljs.initHighlightingOnLoad(); hljs.initLineNumbersOnLoad(); </script> <script src="/js/share-buttons.js"></script> <!--Generated with Jekyll at Nov. 11, 2025 11:59:43 AM (+03)--> </body> </html>
