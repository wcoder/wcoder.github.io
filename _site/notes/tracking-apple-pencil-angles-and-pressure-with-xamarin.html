<!DOCTYPE html> <html prefix="og: http://ogp.me/ns#" lang="ru"> <head> <meta charset="utf-8" /> <meta http-equiv="X-UA-Compatible" content="IE=edge" /> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" /> <title>Отслеживание угла наклона и силы нажания Apple Pencil с помощью Xamarin - YP Tech Notes</title> <meta name="description" content="Ходят слухи, что Apple будет поддерживать Apple Pencil в новых iPad. Если это так, то многие разработчики захотят использовать новые возможности UITouch - си..." /> <meta name="keywords" content="xamarin, f#, ios, перевод" /> <meta name="author" content="Yauheni Pakala"> <meta property="og:title" content="Отслеживание угла наклона и силы нажания Apple Pencil с помощью Xamarin - YP Tech Notes" /> <meta property="og:description" content="Ходят слухи, что Apple будет поддерживать Apple Pencil в новых iPad. Если это так, то многие разработчики захотят использовать новые возможности UITouch - си..." /> <meta property="og:url" content="https://wcoder.github.io/notes/tracking-apple-pencil-angles-and-pressure-with-xamarin" /> <meta property="og:site_name" content="YP Tech Notes" /> <meta property="og:locale" content="ru_RU" /> <meta property="og:type" content="article" /> <meta property="article:author" content="Yauheni Pakala" /> <meta property="article:published_time" content="2016-03-05T23:10:00+03:00" /> <meta name="twitter:card" content="summary" /> <meta name="twitter:creator" content="@yauhenipakala" /> <meta name='yandex-verification' content='7cd440e16ce6e1c3' /> <link rel="icon" type="image/x-icon" href="/images/favicon.ico" /> <link rel="stylesheet" href="/css/main.css" /> <link rel="stylesheet" href="/css/github.min.css" /> <meta name="mobile-web-app-capable" content="yes" /> <meta name="apple-mobile-web-app-capable" content="yes" /> <meta name="application-name" content="YP Tech Notes" /> <meta name="apple-mobile-web-app-title" content="YP Tech Notes" /> <meta name="theme-color" content="#333" /> <meta name="msapplication-navbutton-color" content="#333" /> <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" /> <meta name="msapplication-starturl" content="/" /> <link rel="manifest" href="/api/manifest.json" /> <link rel="canonical" href="https://wcoder.github.io/notes/tracking-apple-pencil-angles-and-pressure-with-xamarin" /> <link rel="alternate" type="application/atom+xml" title="YP Tech Notes" href="https://wcoder.github.io/atom.xml" /> </head> <body> <header class="site-header"><div class="wrapper"> <a class="site-title" href="/" title="Перейти на главную">Tech Notes</a> <nav class="site-nav"> <a href="#" class="menu-icon" title="Развернуть меню"> <svg xmlns="http://www.w3.org/2000/svg" height="29" viewBox="0 0 48 48" width="48"><path d="M0 0h48v48h-48z" fill="none"></path><path d="M6 36h36v-4h-36v4zm0-10h36v-4h-36v4zm0-14v4h36v-4h-36z"></path> </svg> </a><div class="trigger"> <a class="page-link" href="https://ypakala.com/">Об авторе</a> <a class="page-link" href="/archive/">Архив</a> <a class="page-link" href="/search/">Поиск</a> <a class="page-link" href="/atom.xml"><i class="fa fa-rss"></i> RSS</a></div></nav></div></header><div class="page-content"><div class="wrapper"> <article class="post" itemscope itemtype="http://schema.org/BlogPosting"> <header class="post-header"><h1 class="post-title" itemprop="name headline">Отслеживание угла наклона и силы нажания Apple Pencil с помощью Xamarin</h1><p class="post-meta"> <time datetime="2016-03-05T23:10:00+03:00" itemprop="datePublished">05.03.2016 в 23:10</time></p></header><div class="post-content" itemprop="articleBody"><p>Ходят слухи, что Apple будет поддерживать Apple Pencil в новых iPad. Если это так, то многие разработчики захотят использовать новые возможности <code>UITouch</code> - силу, угол, высоту - поддерживаются невероятно точным стилусом.</p><p>В основном это просто:</p><ul> <li>сила - <code>UITouch.Force</code></li> <li>угол - <code>UITouch.GetAzimuthAngle(UIView)</code></li> <li>угол над горизонтом - <code>UITouch.AltitudeAngle</code></li></ul><p>Вот часть кода на F#:</p><pre><code>namespace UITouch0

open System
open UIKit
open Foundation
open System.Drawing
open CoreGraphics

type ContentView(color : UIColor) as this =
   inherit UIView()
   do this.BackgroundColor &lt;- color

   let MaxRadius = 200.0
   let MaxStrokeWidth = nfloat 10.0

   //Mutable!
   member val Circle : (CGPoint * nfloat * nfloat * nfloat ) option = None with get, set

   member this.DrawTouch (touch : UITouch) =
      let radius = (1.0 - (float touch.AltitudeAngle) / (Math.PI / 2.0)) * MaxRadius |&gt; nfloat
      this.Circle &lt;- Some (touch.LocationInView(this), radius, touch.GetAzimuthAngle(this), touch.Force)
      this.SetNeedsDisplay()


   override this.Draw rect =

      match this.Circle with
      | Some (location, radius, angle, force) -&gt;
         let rectUL = new CGPoint(location.X - radius, location.Y - radius)
         let rectSize = new CGSize(radius * (nfloat 2.0), radius * (nfloat 2.0))
         use g = UIGraphics.GetCurrentContext()
         let strokeWidth = force * MaxStrokeWidth
         g.SetLineWidth(strokeWidth)
         let hue = angle / nfloat (Math.PI * 2.0)
         let color = UIColor.FromHSB(hue, nfloat 1.0, nfloat 1.0)
         g.SetStrokeColor(color.CGColor)
         g.AddEllipseInRect &lt;| new CGRect(rectUL, rectSize)
         g.MoveTo (location.X, location.Y)
         let endX = location.X + nfloat (cos(float angle)) * radius
         let endY = location.Y + nfloat (sin(float angle)) * radius
         g.AddLineToPoint (endX, endY)
         g.StrokePath()
      | None -&gt; ignore()

type SimpleController() =
   inherit UIViewController()
   override this.ViewDidLoad() =
      this.View &lt;- new ContentView(UIColor.Blue)

   override this.TouchesBegan(touches, evt) =
     let cv = this.View :?&gt; ContentView

     touches |&gt; Seq.map (fun o -&gt; o :?&gt; UITouch) |&gt; Seq.iter cv.DrawTouch

   override this.TouchesMoved(touches, evt) =
      let cv = this.View :?&gt; ContentView
      touches |&gt; Seq.map (fun o -&gt; o :?&gt; UITouch) |&gt; Seq.iter cv.DrawTouch



[&lt;Register("AppDelegate")&gt;]
type AppDelegate() =
   inherit UIApplicationDelegate()
   let window = new UIWindow(UIScreen.MainScreen.Bounds)

   override this.FinishedLaunching(app, options) =
      let viewController = new SimpleController()
      viewController.Title &lt;- "F# Rocks"
      let navController = new UINavigationController(viewController)
      window.RootViewController &lt;- navController
      window.MakeKeyAndVisible()
      true


module Main =
   [&lt;EntryPoint&gt;]
   let main args =
      UIApplication.Main(args, null, "AppDelegate")
      0
</code></pre><p>И выглядит это так:</p><video controls="controls" width="584" height="778" preload="none"> <source src="https://github.com/wcoder/blog/raw/master/tracking-apple-pencil-angles-and-pressure-with-xamarin/ScreenFlow-2.mp4" /> Элемент video не поддерживается вашим браузером. <a href="https://github.com/wcoder/blog/raw/master/tracking-apple-pencil-angles-and-pressure-with-xamarin/ScreenFlow-2.mp4">Скачайте видео</a>. </video><p><a href="http://www.knowing.net/index.php/2016/03/03/tracking-apple-pencil-angles-and-pressure-with-xamarin/" name="original">Оригинал</a></p><p>Теги: <a href="/tags/#xamarin">xamarin</a>, <a href="/tags/#f%23">f#</a>, <a href="/tags/#ios">ios</a>, <a href="/tags/#%D0%BF%D0%B5%D1%80%D0%B5%D0%B2%D0%BE%D0%B4">перевод</a></p><p class="edit-post-btn"> <!--noindex--><a href="https://github.com/wcoder/wcoder.github.io/edit/master/_posts/2016-03-05-tracking-apple-pencil-angles-and-pressure-with-xamarin.md" rel="nofollow" title="Редактировать страницу на GitHub">Редактировать</a><!--/noindex--></p><div class="share-btn"> <a class="btn-vk" data-id="vk" title="VK"><img alt="VK" width="16" src="/images/vk.svg" /></a> <a class="btn-facebook" data-id="fb" title="Facebook"><img alt="Facebook" width="16" src="/images/facebook.svg" /></a> <a class="btn-twitter" data-id="tw" title="Twitter"><img alt="Twitter" width="16" src="/images/twitter.svg" /></a> <a class="btn-telegram" data-id="tg" title="Telegram"><img alt="Telegram" width="16" src="/images/telegram.svg" /></a> <a class="btn-mail" data-id="mail" title="Email"><img alt="Email" width="16" src="/images/mail.svg" /></a></div></div></article></div></div><hr /><div class="wrapper"> <footer class="footer"><p class="copyrights"> &copy; 2014&ndash;<span itemprop="copyrightYear">2025</span></p><p xmlns:cc="http://creativecommons.org/ns#" class="license"> <a href="http://creativecommons.org/licenses/by-sa/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" title="This work is licensed under CC BY-SA 4.0"> <img style="height:20px!important;" src="https://licensebuttons.net/l/by-sa/4.0/88x31.png" alt="CC BY-SA 4.0"> </a></p></footer></div><script src="/js/highlight.pack.js"></script> <script src="/js/highlightjs-line-numbers.min.js"></script> <script> hljs.initHighlightingOnLoad(); hljs.initLineNumbersOnLoad(); </script> <script src="/js/share-buttons.js"></script> <!--Generated with Jekyll at Nov. 11, 2025 11:59:43 AM (+03)--> </body> </html>
